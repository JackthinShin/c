<!--Version:1.2.4-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>C è¯­è¨€åœ¨çº¿ç¼–è¯‘å™¨ | HCY ZJU</title>
    <!-- å­—ä½“å›¾æ ‡å’Œ Monaco åŠ è½½å™¨ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uncrustify-wasm@2.0.1/dist/uncrustify.js"></script>

    <!-- Highlight.js themes (prefetch links; actual enable/disable handled by script) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css" id="hljs-theme-dark" disabled>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css" id="hljs-theme-light" disabled>

    <style>
        :root{
            --sidebar-width: 380px;
            --bg: #0b0c0d;           /* é¡µé¢èƒŒæ™¯ï¼ˆnear blackï¼‰ */
            --panel: #0f1113;        /* å¡ç‰‡ / ä¸»å®¹å™¨èƒŒæ™¯ */
            --muted: #9aa4ad;        /* æ¬¡è¦æ–‡å­— */
            --accent: #48a0ff;       /* é«˜äº®è‰²ï¼ˆé€‚åº¦ï¼‰ */
            --glass: rgba(255,255,255,0.02);
            --radius: 10px;
            --shadow: 0 8px 30px rgba(0,0,0,0.6);
            --anim-enter: cubic-bezier(.16,.84,.44,1);
        }

        /* æ˜äº®ä¸»é¢˜è¦†ç›–å˜é‡ï¼ˆåˆ‡æ¢æ—¶å°† body æ·»åŠ  .light-themeï¼‰ */
        .light-theme{
            --bg: #f3f6fb;
            --panel: #ffffff;
            --muted: #4b5563;
            --accent: #2563eb;
            --glass: rgba(0,0,0,0.04);
            --shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        body.light-theme .frame{background:var(--panel)}
        body.light-theme header{background:linear-gradient(180deg,#ffffff,rgba(255,255,255,0.85))}
        body.light-theme .toolbar{background:#ffffff;border-top:1px solid rgba(0,0,0,0.08)}
        body.light-theme .sidebar{background:linear-gradient(180deg,#ffffff,rgba(255,255,255,0.85))}

        *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{background:var(--bg);color:var(--muted);transition:background-color .45s ease,color .45s ease}

        /* åº”ç”¨å®¹å™¨ï¼šå æ»¡æ•´ä¸ªè§†å£ï¼Œç±»ä¼¼æœ¬åœ° app çš„å…¨å±ç¼–è¾‘å™¨ */
        .app{height:100vh;width:100vw;display:flex;flex-direction:column;align-items:stretch;justify-content:stretch}
    .frame{max-width:1400px;margin:12px auto;flex:1;background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;transition:background-color .45s ease,box-shadow .45s ease;min-height:0;width:100%}

    header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);transition:background-color .45s ease}
        header .title{display:flex;align-items:center;gap:10px;font-weight:600}
        header .title i{color:var(--accent);font-size:18px}
    header .meta{color:var(--muted);font-size:13px}
    header .meta a{color:var(--muted);text-decoration:none;display:inline-flex;align-items:center;gap:6px;cursor:pointer}
    header .meta a:hover{color:var(--accent);text-decoration:underline}

    /* ä¸»åŒºï¼šç¼–è¾‘å™¨ + ä¾§æ  */
    .main{flex:1;display:flex;min-height:0;position:relative}

        /* ç¼–è¾‘åŒº */
    .editor-wrap{flex:1;display:flex;flex-direction:column;border-right:1px solid rgba(0,0,0,0.06);transition:background-color .4s ease,border-color .4s ease;z-index:5;min-height:0}
    .editor-head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
    .editor-head h2{font-size:14px;color:#dbe9ff}
    #editor{flex:1;min-height:0;height:100%}

        /* å·¥å…·æ  */
        .toolbar{display:flex;gap:8px;padding:10px 14px;align-items:center;flex-wrap:wrap}
    .btn{border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px;background:transparent;color:var(--muted);transition:color .3s}
    .btn.primary{background:var(--accent);color:#071022}
    .btn.ghost{border:1px solid rgba(0,0,0,0.06)}
    /* æŒ‰é’®ç¦ç”¨è§†è§‰çŠ¶æ€ */
    .btn[disabled]{opacity:.45;cursor:not-allowed;filter:grayscale(25%)}

    /* ä¾§æ  */
    /* ä¾§æ ï¼šä½¿ç”¨ç»å¯¹å®šä½ä»¥è¦†ç›–ç¼–è¾‘åŒºï¼Œé¿å…è¢« Monaco canvas é®æŒ¡ */
    /* ä¾§æ ï¼šè¦†ç›–å¼å®šä½ï¼Œä½†ä¿ç•™é¡¶éƒ¨ä¸åº•éƒ¨é—´éš”ï¼Œé¿å…é®æŒ¡ header ä¸ åº•éƒ¨å·¥å…·æ ï¼›JS ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—ç²¾ç¡®çš„ top/bottom */
    .sidebar{width:var(--sidebar-width);display:flex;flex-direction:column;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);transition:width .28s ease,opacity .28s ease,padding .28s ease;position:absolute;right:0;top:56px;bottom:72px;z-index:1000}
    /* æŠ˜å ä¾§æ ï¼šè®¾ç½®å®½åº¦ä¸º0å¹¶éšè—å†…è¾¹è·ï¼Œç¼–è¾‘å™¨ä¼šè‡ªåŠ¨å æ»¡å‰©ä½™ç©ºé—´ */
    .sidebar.collapsed{width:0;padding:0;opacity:0;pointer-events:none}
        .sb-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px}
        .sb-section{padding:12px 14px;flex:1;overflow:auto}
        textarea,input[type=text]{width:100%;padding:10px;border:1px solid rgba(255,255,255,0.03);border-radius:8px;background:transparent;color:#e6eef6;font-family:monospace}
        .output{background:var(--glass);color:#dfefff;padding:12px;border-radius:8px;white-space:pre-wrap;height:100%;overflow:auto;font-family:monospace}

    /* æ‚¬æµ®çš„ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’®ï¼ˆå½“ä¾§æ æŠ˜å æ—¶å¯æ¢å¤ï¼‰ */
    #sidebarToggle{position:fixed;right:18px;bottom:24px;width:44px;height:44px;border-radius:10px;background:var(--panel);border:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;color:var(--accent);box-shadow:var(--shadow);cursor:pointer;transition:opacity .2s;z-index:2000}

    /* æ³¨æ„ï¼šç¼–è¾‘å™¨ä¿æŒå§‹ç»ˆå¡«æ»¡å®½åº¦ï¼Œä¾§æ æ˜¯è¦†ç›–å¼çš„ä½†ä¸Šä¸‹æœ‰ç•™ç™½ä»¥é¿å…é®æŒ¡å¤´éƒ¨ä¸åº•éƒ¨æ§ä»¶ */

        /* å°å±é€‚é… */
        /* iPad æ¨ª/ç«–å± & æ‰‹æœºé€‚é… */
        @media (max-width:1180px){
            :root{--sidebar-width:320px}
        }
        @media (max-width:1024px){ /* iPad ç«–å± */
            :root{--sidebar-width:300px}
            header{padding:10px 12px}
            .editor-head{padding:8px 10px}
            .toolbar{padding:8px 10px}
            .btn{padding:6px 10px;font-size:12px}
        }
        @media (max-width:900px){ /* å¤§æ‰‹æœº/å°å¹³æ¿ */
            .sidebar{position:static;width:100%;height:auto;top:auto;bottom:auto;border-top:1px solid rgba(255,255,255,0.06);order:2}
            .main{flex-direction:column}
            #sidebarToggle{display:none !important}
        }
        @media (max-width:640px){ /* æ‰‹æœºä¼˜åŒ–ï¼šå·¥å…·æ æ¢è¡Œï¼Œå­—å·å‹ç¼© */
            .btn{padding:6px 8px;font-size:11px}
            .toolbar{gap:6px}
            .editor-head h2{font-size:12px}
            .output{font-size:12px}
        }
        /* å¥¶èŒ¶å¼¹çª—è¿›å…¥åŠ¨ç”» */
        #milkTeaModal{opacity:0;transform:translateY(12px) scale(.96);transition:opacity .38s var(--anim-enter),transform .38s var(--anim-enter)}
        #milkTeaModal.show{opacity:1;transform:translateY(0) scale(1)}
    </style>
</head>
<body>
    <div class="app">
        <div class="frame">
        <header>
            <div class="title"><i class="fas fa-code"></i><div>Online C Compiler</div></div>
        </header>

        <div class="main">
            <div class="editor-wrap">
                <div class="editor-head">
                    <h2><i class="fas fa-file-code"></i> <span id="fileTitle">main.c</span></h2>
                    <!-- ç§»é™¤å†—ä½™çš„æ–‡å­—çŠ¶æ€æç¤ºï¼Œä»…ä¿ç•™æ–‡ä»¶åæ˜Ÿå·è¡¨ç¤ºæœªä¿å­˜ -->
                    <div style="flex:1"></div>
                    <button class="btn ghost" id="saveAsBtn"><i class="fas fa-download"></i> å¦å­˜ä¸º</button>
                    <button class="btn ghost" id="themeBtn"><i class="fas fa-sun"></i> ä¸»é¢˜</button>
                </div>
                <div id="editor"></div>
            </div>

            <aside class="sidebar" id="sidebar">
                <div class="sb-head"><div><i class="fas fa-terminal"></i> è¿è¡Œç»“æœ</div><button id="closeSb" class="btn ghost">æŠ˜å </button></div>
                <div class="sb-section">
                    <label>è¾“å…¥ (stdin)</label>
                    <textarea id="stdin" rows="3" placeholder="è¯·å…ˆè¾“å…¥å†ç‚¹å‡»è¿è¡Œ..."></textarea>
                    <div style="height:12px"></div>
                    <label>è¾“å‡º (stdout)</label>
                    <div class="output" id="stdout">ç¨‹åºè¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
                </div>
            </aside>
        </div>
        <!-- åº•éƒ¨å·¥å…·æ ï¼šè¿è¡Œ / æ‰“å¼€ / è‡ªåŠ¨ç¼©è¿› / å¤åˆ¶ / æ’¤é”€ / é‡åš / å…¨å± / ç‰ˆæƒä¸ç‰ˆæœ¬å· -->
        <div class="toolbar">
            <button class="btn primary" id="runBtn"><i class="fas fa-play"></i> è¿è¡Œ</button>
            <button class="btn ghost" id="openFileBtn"><i class="fas fa-folder-open"></i> æ‰“å¼€</button>
            <button class="btn ghost" id="formatBtn"><i id="formatLoadingIcon" class="fas fa-indent"></i> <span id="formatBtnText">è‡ªåŠ¨ç¼©è¿›</span></button>
            <button class="btn ghost" id="copyBtn" title="å¤åˆ¶"><i class="fas fa-copy"></i> å¤åˆ¶</button>
            <button class="btn ghost" id="undoBtn" title="æ’¤é”€" disabled><i class="fas fa-undo"></i></button>
            <button class="btn ghost" id="redoBtn" title="é‡åš" disabled><i class="fas fa-redo"></i></button>
            <button class="btn ghost" id="fsBtn"><i class="fas fa-expand"></i> å…¨å±</button>
            <a id="introLink" href="./about.html" target="_blank" style="margin-left:auto;color:var(--muted);font-size:12px;text-decoration:none"><i class="fas fa-circle-info"></i> ç®€ä»‹ä¸å¸®åŠ©</a>
            <a id="versionLink" href="javascript:void(0)" style="color:var(--muted);font-size:12px;text-decoration:none;padding-left:12px">By C. He from ZJU | v1.2.4</a>
        </div>
        </div>
    </div>

    <!-- æŠ˜å åæ¢å¤ä¾§æ çš„æ‚¬æµ®æŒ‰é’® -->
    <div id="sidebarToggle" title="æ‰“å¼€ä¾§æ "><i class="fas fa-chevron-left"></i></div>
    <!-- éšè—çš„æœ¬åœ°æ–‡ä»¶é€‰æ‹©å™¨ -->
    <input type="file" id="fileInput" accept=".c,.cpp,.h,.hpp,.txt" style="display:none" />

    <!-- Changelog modal (hidden by default) -->
    <div id="changelogModal" aria-hidden="true" style="display:none">
        <div class="changelog-sheet" role="dialog" aria-modal="true" aria-labelledby="changelogTitle">
            <button class="changelog-close" aria-label="å…³é—­æ›´æ–°æ—¥å¿—">âœ•</button>
            <div id="changelogContent"></div>
        </div>
    </div>

    <script>
        /**********************************************************************
         * ç®€æ´ç‰ˆè„šæœ¬ï¼šåŠŸèƒ½
         * - åˆå§‹åŒ– Monaco ç¼–è¾‘å™¨
         * - æœ¬åœ°ä¿å­˜/åŠ è½½ä»£ç ï¼ˆlocalStorageï¼‰
         * - ç®€å•è¿è¡Œï¼ˆæ¨¡æ‹Ÿ scanf/printfï¼‰
         * - ä¸»é¢˜åˆ‡æ¢ä¸ UI çŠ¶æ€æ›´æ–°
         * æ‰€æœ‰æ³¨é‡Šä¸ºä¸­æ–‡ï¼Œä¾¿äºç»´æŠ¤ã€‚
         **********************************************************************/

        // é»˜è®¤ä»£ç ï¼ˆä¿æŒä¸ UI åŠŸèƒ½ä¸€è‡´çš„ç¤ºä¾‹ï¼‰
        const DEFAULT_CODE = `#include <stdio.h>

int main() {
    printf("By ZJU C. He");
    return 0;
}`;

        // ç¼–è¾‘å™¨è„æ ‡è®°ï¼ˆæœªä¿å­˜çŠ¶æ€ï¼‰
        let isDirty = false;

        // DOM å¼•ç”¨
    const runBtn = document.getElementById('runBtn');
    const copyBtn = document.getElementById('copyBtn');
        const themeBtn = document.getElementById('themeBtn');
        const stdinEl = document.getElementById('stdin');
        const stdoutEl = document.getElementById('stdout');
        const saveStatus = document.getElementById('saveStatus');
        const closeSb = document.getElementById('closeSb');

        // Monaco ç¼–è¾‘å™¨éœ€è¦å¼‚æ­¥åŠ è½½
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            // å°è¯•ä» localStorage åŠ è½½ä¹‹å‰ä¿å­˜çš„ä»£ç 
            const saved = localStorage.getItem('deepseek_saved_c');
            window.editor = monaco.editor.create(document.getElementById('editor'), {
                value: saved || DEFAULT_CODE,
                language: 'c',
                theme: (localStorage.getItem('editorTheme') === 'light') ? 'vs-light' : 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false },
                fontSize: 13,
                scrollBeyondLastLine: false
            });

            // æ’¤é”€/é‡åšè‡ªåŠ¨ç¦ç”¨ï¼šåŸºäºå†…å®¹å˜æ›´äº‹ä»¶ç»´æŠ¤ç®€æ˜“å†å²æŒ‡é’ˆ
            let __histIdx = 0;
            let __histMax = 0;
            function updateUndoRedoButtons(){
                try{
                    const undoBtn = document.getElementById('undoBtn');
                    const redoBtn = document.getElementById('redoBtn');
                    if (undoBtn) undoBtn.disabled = (__histIdx <= 0);
                    if (redoBtn) redoBtn.disabled = (__histIdx >= __histMax);
                }catch(e){}
            }
            updateUndoRedoButtons();

            try {
                window.editor.onDidChangeModelContent((e) => {
                    try{
                        if (e && e.isUndoing) {
                            __histIdx = Math.max(0, __histIdx - 1);
                        } else if (e && e.isRedoing) {
                            __histIdx = Math.min(__histMax, __histIdx + 1);
                        } else {
                            // æ–°ç¼–è¾‘ä¼šæˆªæ–­ redo
                            if (__histIdx < __histMax) {
                                __histMax = __histIdx;
                            }
                            __histIdx += 1;
                            __histMax = __histIdx;
                        }
                    }catch(err){}
                    updateUndoRedoButtons();
                });
            } catch(e) {}

            // åº”ç”¨ body ä¸»é¢˜ç±»ï¼ˆæŒä¹…åŒ–ï¼‰
            try { if (localStorage.getItem('editorTheme') === 'light') document.body.classList.add('light-theme'); } catch (e) {}

            // ç¼–è¾‘å™¨å†…å®¹æ”¹å˜æ—¶æ ‡è®°ä¸ºæœªä¿å­˜ï¼ˆæ·»åŠ  '*'ï¼‰
            try {
                window.editor.onDidChangeModelContent(() => {
                    if (!isDirty) setDirty(true);
                });
            } catch (e) {}

            // ç§»é™¤ Ctrl/Cmd+S ä¿å­˜å¿«æ·é”®ï¼ˆä»…ä¿ç•™å¦å­˜ä¸ºåŠŸèƒ½ï¼‰
        });

    // ----------------- åŠŸèƒ½å‡½æ•° -----------------

        // runCode: ä¼˜å…ˆå°è¯• Wandboxï¼ˆçœŸå®ç¼–è¯‘å™¨ï¼‰ï¼Œè‹¥å¤±è´¥å°è¯•åŠ è½½æœ¬åœ° WASM è¿è¡Œå™¨ï¼ˆè‹¥ä½ å·²éƒ¨ç½²ï¼‰
        // æœ€åå›é€€åˆ°åŸæœ‰çš„æ¨¡æ‹Ÿï¼ˆsimulateRunï¼‰ã€‚Wandbox API: https://wandbox.org
        async function tryWandboxCompile(code, stdin) {
            const wandboxUrl = 'https://wandbox.org/api/compile.json';
            const payload = {
                code,
                compiler: 'gcc-head', // å¯æ”¹ä¸º clang-head æˆ–å…¶ä»–
                stdin: stdin || undefined,
                save: false
            };

            const fetchWithTimeout = (url, opts, timeout = 8000) => {
                return Promise.race([
                    fetch(url, opts),
                    new Promise((_, rej) => setTimeout(() => rej(new Error('timeout')), timeout))
                ]);
            };

            const resp = await fetchWithTimeout(wandboxUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }, 10000);

            if (!resp.ok) throw new Error('Wandbox è¿”å› ' + resp.status);
            const json = await resp.json();

            // Wandbox è¿”å›å­—æ®µä¸æ€»æ˜¯å›ºå®šï¼Œå¸¸è§æœ‰: program_output / program_error / compiler_output
            const out = (json.program_output || json.program_stdout || json.program || json.result || '') || '';
            const err = (json.program_error || json.program_stderr || json.compiler_error || json.compiler_output || '') || '';
            const status = json.status ?? 0;
            return { stdout: out, stderr: err, exitCode: status };
        }

        // åŠ¨æ€åŠ è½½å‰ç«¯ WASM è¿è¡Œå™¨ï¼ˆå¦‚æœä½ åœ¨ repo ä¸‹æ”¾ç½®äº† /wasm/tcc_runner.jsï¼‰
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = url;
                s.onload = () => resolve();
                s.onerror = (e) => reject(new Error('åŠ è½½å¤±è´¥: ' + url));
                document.head.appendChild(s);
            });
        }

        // å¦‚æœç”¨æˆ·åœ¨ä»“åº“ä¸­æ”¾ç½®äº†ä¸€ä¸ªåŸºäº tcc/clang çš„ wasm è¿è¡Œå™¨å¹¶æš´éœ² window.wasmRun(code, stdin)
        async function tryWasmRun(code, stdin) {
            // å¸¸ç”¨è·¯å¾„ï¼š/wasm/tcc_runner.jsï¼ˆä½ éœ€è¦æŠŠç›¸åº”çš„è„šæœ¬å’Œ wasm æ”¾åˆ°è¯¥è·¯å¾„ï¼‰
            if (typeof window.wasmRun === 'function') {
                return await window.wasmRun(code, stdin);
            }

            // å°è¯•åŠ¨æ€åŠ è½½é¢„æœŸçš„è„šæœ¬ï¼ˆå¦‚æœä½ å·²ä¸Šä¼ ï¼‰
            try {
                await loadScript('/wasm/tcc_runner.js');
                if (typeof window.wasmRun === 'function') {
                    return await window.wasmRun(code, stdin);
                } else {
                    throw new Error('wasmRun æœªåœ¨è„šæœ¬ä¸­æš´éœ²');
                }
            } catch (e) {
                throw e;
            }
        }

        async function runCode() {
            if (!window.editor) return;
            const code = window.editor.getValue();
            const stdin = (stdinEl.value || '').trim();
            stdoutEl.textContent = 'è¿è¡Œä¸­ï¼ˆWandbox ä¼˜å…ˆï¼‰...';
            try {
                const res = await tryWandboxCompile(code, stdin);
                let out = '';
                if (res.stdout) out += res.stdout;
                if (res.stderr) out += '\n[stderr]\n' + res.stderr;
                out += `\n[exit code] ${res.exitCode ?? 0}`;
                stdoutEl.textContent = out.trim();
                return;
            } catch (e) {
                console.warn('Wandbox è°ƒç”¨å¤±è´¥ï¼š', e);
                stdoutEl.textContent = 'Wandbox ä¸å¯ç”¨ï¼Œå›é€€åˆ°æœ¬åœ°æ¨¡æ‹Ÿ...';
            }
            simulateRun(code, stdin);
        }

        // æœ¬åœ°å›é€€ï¼šç®€å•æ¨¡æ‹Ÿ scanf/printf è¡Œä¸ºï¼ˆä»…ä½œæ¼”ç¤ºï¼‰
        function simulateRun(code, input) {
            stdoutEl.textContent = 'æœ¬åœ°æ¨¡æ‹Ÿè¿è¡Œ...';
            setTimeout(() => {
                if (/scanf\s*\(/.test(code) && (!input || input.trim() === '')) {
                    stdoutEl.textContent = 'é”™è¯¯ï¼šç¨‹åºéœ€è¦è¾“å…¥ä½†æœªæä¾› stdinã€‚';
                    return;
                }

                if (!input || input.trim() === '') {
                    stdoutEl.textContent = 'æç¤ºï¼šè¯·åœ¨å·¦ä¾§è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œä¾‹å¦‚ï¼š10 20';
                    return;
                }

                const parts = input.split(/\s+/).map(s => parseInt(s, 10));
                if (parts.length >= 2 && parts.every(n => Number.isFinite(n))) {
                    const [a, b] = parts;
                    stdoutEl.textContent = `ä¸¤æ•°ä¹‹å’Œä¸ºï¼š${a + b}`;
                } else {
                    stdoutEl.textContent = 'é”™è¯¯ï¼šè¾“å…¥æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼ˆä¾‹å¦‚ï¼š10 20ï¼‰';
                }
            }, 300);
        }

        // åˆ‡æ¢ä¸»é¢˜ï¼ˆè½»/æš—ï¼‰ï¼Œé»˜è®¤æš—é»‘ã€‚æˆ‘ä»¬é€šè¿‡ body çš„ .light-theme ç±»åˆ‡æ¢ CSS å˜é‡
        // ä¸»é¢˜æŒä¹…åŒ–åˆ° localStorage: 'editorTheme' = 'dark' | 'light'
        let isDark = true;
        // è¯»å–æŒä¹…åŒ–ä¸»é¢˜ï¼ˆè‹¥å­˜åœ¨ï¼‰
        try {
            const stored = localStorage.getItem('editorTheme');
            if (stored) isDark = stored === 'dark';
        } catch (e) {}

        function applyThemeImmediately() {
            document.body.classList.toggle('light-theme', !isDark);
            try { if (window.monaco) monaco.editor.setTheme(isDark ? 'vs-dark' : 'vs-light'); } catch (e) {}
            themeBtn.innerHTML = isDark ? '<i class="fas fa-sun"></i> æ˜äº®' : '<i class="fas fa-moon"></i> æš—è‰²';
        }

        function toggleTheme() {
            isDark = !isDark;
            // æŒä¹…åŒ–
            try { localStorage.setItem('editorTheme', isDark ? 'dark' : 'light'); } catch (e) {}
            // æ·»åŠ /ç§»é™¤å…¨å±€ç±»ä»¥åˆ‡æ¢ CSS å˜é‡ï¼ˆå¹³æ»‘è¿‡æ¸¡ï¼‰
            document.body.classList.toggle('light-theme', !isDark);
            // æ›´æ–°æŒ‰é’®æ–‡æ¡ˆå¹¶åœ¨çŸ­å»¶è¿Ÿååˆ‡æ¢ Monaco ä¸»é¢˜ï¼Œé¿å…å¼ºçƒˆåå·®
            themeBtn.innerHTML = isDark ? '<i class="fas fa-sun"></i> æ˜äº®' : '<i class="fas fa-moon"></i> æš—è‰²';
            try {
                setTimeout(() => {
                    monaco.editor.setTheme(isDark ? 'vs-dark' : 'vs-light');
                }, 180);
            } catch (e) {}
        }

    // ----------------- äº‹ä»¶ç»‘å®š -----------------
    // å¸¸è§„ç»‘å®šï¼ˆè‹¥æ­¤æ—¶å…ƒç´ å­˜åœ¨ï¼‰
    try { runBtn && runBtn.addEventListener('click', runCode); } catch (e) {}
        try {
            const copyBtn = document.getElementById('copyBtn');
            copyBtn && copyBtn.addEventListener('click', () => {
                try {
                    const code = window.editor ? window.editor.getValue() : '';
                    navigator.clipboard.writeText(code).then(() => {
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                        setTimeout(()=>{copyBtn.innerHTML = '<i class="fas fa-copy"></i> å¤åˆ¶';},1200);
                    }).catch(err => { alert('å¤åˆ¶å¤±è´¥: ' + err.message); });
                } catch(e){ alert('å¤åˆ¶å¤±è´¥'); }
            });
        } catch (e) {}
    // ä¿å­˜ä¸é‡ç½®åŠŸèƒ½å·²ç§»é™¤
    try { themeBtn && themeBtn.addEventListener('click', toggleTheme); } catch (e) {}
    // æ’¤é”€/é‡åšæŒ‰é’®ç»‘å®šï¼ˆè„šæœ¬åŒºæ­£ç¡®ç»‘å®šï¼‰
    try {
        const undoBtn = document.getElementById('undoBtn');
        const redoBtn = document.getElementById('redoBtn');
        if (undoBtn) undoBtn.addEventListener('click', () => { if (window.editor) window.editor.trigger('toolbar','undo'); });
        if (redoBtn) redoBtn.addEventListener('click', () => { if (window.editor) window.editor.trigger('toolbar','redo'); });
    } catch(e) {}
    // çº¯ JS é«˜çº§ C ä»£ç è‡ªåŠ¨ç¼©è¿›ç¾åŒ–
    (function(){
        const formatBtn = document.getElementById('formatBtn');
        const formatIcon = document.getElementById('formatLoadingIcon');
        const formatText = document.getElementById('formatBtnText');
        if (!formatBtn) return;
        formatBtn.disabled = false;
        function smartCIndent(code, tabSize) {
            tabSize = tabSize || 4;
            const tab = ' '.repeat(tabSize);
            const lines = code.split(/\r?\n/);
            let indent = 0;
            let inBlockComment = false, inString = false, stringChar = '';
            let result = [];
            // æ§åˆ¶æµæ ˆï¼šè®°å½•æ— å¤§æ‹¬å·çš„å•è¡Œä½“ï¼ˆsingleï¼‰ä¸ do...whileï¼ˆdoï¼‰
            // æ ˆå…ƒç´ ï¼š{ type: 'single'|'do', applied: boolean }
            let controlStack = [];
            let inSwitch = false, inCase = false, caseIndent = 0;
            const controlRegex = /^(if|for|while|else if|else|do|switch)\b.*\)?\s*$/;
            const elseRegex = /^else(\s+if)?\b/;
            const caseRegex = /^(case |default:)/;
            for (let idx = 0; idx < lines.length; idx++) {
                let rawLine = lines[idx];
                let line = rawLine.trimEnd();
                let trimmed = line.trim();
                // é¢„å¤„ç†æŒ‡ä»¤ # å¼€å¤´ä¸ç¼©è¿›
                if (/^#/.test(trimmed)) {
                    result.push(trimmed);
                    continue;
                }
                // å¤„ç†å¤šè¡Œæ³¨é‡Š
                let i = 0, n = line.length, openBraces = 0, closeBraces = 0, caseOrDefault = false;
                while (i < n) {
                    let ch = line[i];
                    // è·³è¿‡å­—ç¬¦ä¸²
                    if (!inBlockComment && !inString && (ch === '"' || ch === "'")) {
                        inString = true; stringChar = ch; i++;
                        continue;
                    }
                    if (inString) {
                        if (ch === '\\' && i+1 < n) { i+=2; continue; }
                        if (ch === stringChar) { inString = false; stringChar = ''; }
                        i++;
                        continue;
                    }
                    // è·³è¿‡æ³¨é‡Š
                    if (!inBlockComment && ch === '/' && i+1 < n && line[i+1] === '*') {
                        inBlockComment = true; i+=2; continue;
                    }
                    if (inBlockComment) {
                        if (ch === '*' && i+1 < n && line[i+1] === '/') { inBlockComment = false; i+=2; continue; }
                        i++;
                        continue;
                    }
                    // å•è¡Œæ³¨é‡Š
                    if (!inString && ch === '/' && i+1 < n && line[i+1] === '/') break;
                    // ç»Ÿè®¡å¤§æ‹¬å·
                    if (!inString && !inBlockComment) {
                        if (ch === '{') openBraces++;
                        if (ch === '}') closeBraces++;
                    }
                    i++;
                }
                // case/default è¯­å¥å‡å°‘ä¸€çº§ç¼©è¿›
                if (caseRegex.test(trimmed)) caseOrDefault = true;
                // switch-case ç¼©è¿›å¤„ç†
                if (/^switch\b/.test(trimmed)) {
                    inSwitch = true;
                    caseIndent = indent;
                }
                if (inSwitch && caseRegex.test(trimmed)) {
                    inCase = true;
                }
                if (inCase && !caseRegex.test(trimmed) && trimmed && !trimmed.startsWith('}') && !trimmed.startsWith('{')) {
                    // case å†…å¤šè¡Œè¯­å¥ç¼©è¿›
                    indent++;
                }
                // æ§åˆ¶æµç¼©è¿›æ ˆå¤„ç†
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ§åˆ¶è¯­å¥ä¸”ä¸ä»¥ { ç»“å°¾
                let isControl = controlRegex.test(trimmed) && !trimmed.endsWith('{');
                // do...while ç‰¹æ®Šå¤„ç†
                let isDo = /^do\b/.test(trimmed);
                let isWhile = /^while\b/.test(trimmed);
                let isElse = elseRegex.test(trimmed);
                // } åœ¨è¡Œé¦–åˆ™å…ˆå‡å°‘ç¼©è¿›
                let effectiveIndent = indent;
                if (trimmed.startsWith('}')) effectiveIndent = Math.max(0, indent-1);
                if (caseOrDefault) effectiveIndent = Math.max(0, effectiveIndent-1);
                // else if/else ç¼©è¿›å¯¹é½
                if (isElse && result.length > 0) {
                    // else/else if ä¸å‰ä¸€è¡Œå¯¹é½
                    let prev = result[result.length-1];
                    let prevIndent = prev.match(/^(\s*)/)[1].length/tabSize;
                    effectiveIndent = prevIndent;
                }
                // è®¡ç®—å•è¡Œä½“çš„é¢å¤–ç¼©è¿›ï¼šå½“ä¸Šä¸€è¡Œæ˜¯æ§åˆ¶è¯­å¥ä¸”æ— å¤§æ‹¬å·æ—¶ï¼Œä»æœ¬è¡Œå¼€å§‹é¢å¤– +1
                const controlStart = /^(if|for|while|else|do|switch)\b/;
                const isSignificantStatement = (s) => {
                    if (!s) return false;
                    if (s.startsWith('#')) return false;
                    if (s.startsWith('{') || s.startsWith('}')) return false;
                    if (s.startsWith('//')) return false;
                    if (caseRegex.test(s)) return false; // case/default æ ‡ç­¾ä¸ç®—è¯­å¥
                    if (controlStart.test(s)) return false; // æ§åˆ¶è¡Œæœ¬èº«ä¸ä½œä¸ºè¢«æ§åˆ¶è¯­å¥
                    return true;
                };
                // æ ‡è®°æœ¬è¡Œæ˜¯å¦å¼€å§‹æˆä¸ºæŸä¸ª single/do çš„å—æ§è¯­å¥
                for (let k = 0; k < controlStack.length; k++) {
                    const item = controlStack[k];
                    if (!item.applied && isSignificantStatement(trimmed)) item.applied = true;
                }
                // åº”ç”¨é¢å¤–ç¼©è¿›ï¼ˆåµŒå¥— single/do æ¯ä¸ª +1ï¼‰
                const extraSingles = controlStack.reduce((acc, it) => acc + (it.applied ? 1 : 0), 0);
                effectiveIndent += extraSingles;
                // å…¥æ ˆï¼šæœ¬è¡Œè‹¥æ˜¯æ§åˆ¶è¯­å¥ï¼ˆé doï¼‰ä¸”ä¸ä»¥ { ç»“æŸï¼Œåˆ™ç™»è®°ä¸º singleï¼›do å•ç‹¬ç™»è®°ä¸º do
                if (isDo) {
                    controlStack.push({ type:'do', applied:false });
                } else if (isControl) {
                    controlStack.push({ type:'single', applied:false });
                }
                // è¾“å‡ºç¼©è¿›
                result.push(tab.repeat(effectiveIndent) + trimmed);
                // è¡Œå†… } å¤šäº {ï¼Œåˆ™å‡å°‘ç¼©è¿›
                indent += openBraces - closeBraces;
                if (trimmed.startsWith('}')) indent = Math.max(0, indent);
                // æ§åˆ¶æµæ ˆå¼¹å‡ºé€»è¾‘
                if (controlStack.length > 0) {
                    // è‹¥é‡åˆ°å—å¼€å§‹ '{'ï¼Œè¯´æ˜ä¸æ˜¯å•è¡Œä½“ï¼šæ¸…ç†æ‰€æœ‰æœªåº”ç”¨çš„ single/do
                    if (trimmed.startsWith('{')) {
                        controlStack = controlStack.filter(it => it.applied);
                    }
                    // do...whileï¼šåœ¨ while(...); è¡Œå¼¹å‡ºæœ€è¿‘çš„ do
                    if (isWhile && trimmed.endsWith(';')) {
                        for (let p = controlStack.length - 1; p >= 0; p--) {
                            if (controlStack[p].type === 'do') { controlStack.splice(p,1); break; }
                        }
                    }
                    // å•è¡Œä½“ï¼šåˆ°è¾¾è¯­å¥ç»“æŸï¼ˆä»¥ ; ç»“å°¾ï¼‰åå¼¹å‡ºæ‰€æœ‰å·²åº”ç”¨çš„ single
                    if (trimmed.endsWith(';')) {
                        controlStack = controlStack.filter(it => !(it.type==='single' && it.applied));
                    }
                }
                // switch-case ç¼©è¿›æ¢å¤
                if (inCase && (trimmed.endsWith('break;') || trimmed.endsWith('return;') || trimmed.endsWith('continue;') || trimmed.endsWith('goto;') || trimmed.endsWith('}') || trimmed === '')) {
                    indent = caseIndent;
                    inCase = false;
                }
                // å…³é—­ switch
                if (inSwitch && trimmed.startsWith('}')) {
                    inSwitch = false;
                    inCase = false;
                }
            }
            return result.join('\n');
        }
        formatBtn.addEventListener('click', function() {
            if (!window.editor) return;
            try {
                formatBtn.disabled = true;
                if (formatIcon) formatIcon.className = 'fas fa-spinner fa-spin';
                formatText.textContent = 'æ ¼å¼åŒ–ä¸­...';
                const code = window.editor.getValue();
                const formatted = smartCIndent(code, 4);
                if (formatted) window.editor.setValue(formatted);
            } catch (err) {
                alert('æ ¼å¼åŒ–å¤±è´¥ï¼š' + (err && err.message));
            } finally {
                formatBtn.disabled = false;
                if (formatIcon) formatIcon.className = 'fas fa-indent';
                formatText.textContent = 'è‡ªåŠ¨ç¼©è¿›';
            }
        });
    })();

        // ä¾§æ æŠ˜å /å±•å¼€é€»è¾‘ï¼šä½¿ç”¨ class 'collapsed'ï¼Œä¾¿äºåŠ¨ç”»ä¸æ¢å¤
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const editorWrap = document.querySelector('.editor-wrap');
        closeSb.addEventListener('click', () => {
            sidebar.classList.add('collapsed');
            sidebarToggle.style.display = 'flex';
            // æŠ˜å ä¾§æ æ—¶ä¸æ”¹å˜ç¼–è¾‘å™¨å®½åº¦ï¼ˆç¼–è¾‘å™¨å§‹ç»ˆå¡«æ»¡å®½åº¦ï¼‰ï¼Œä»…è§¦å‘å¸ƒå±€
            try { editorWrap && editorWrap.classList.add('full'); } catch (e) {}
            setTimeout(() => { try { window.editor && window.editor.layout(); } catch (e) {} }, 320);
        });
        sidebarToggle.addEventListener('click', () => {
            // å±•å¼€ä¾§æ ï¼šå…ˆç§»é™¤ collapsedï¼Œä½¿å…¶æ¢å¤åˆ°æ­£å¸¸å®½åº¦
            sidebar.classList.remove('collapsed');
            // å¼ºåˆ¶ä¸€æ¬¡é‡æ’ä»¥ç¡®ä¿æµè§ˆå™¨åº”ç”¨å®½åº¦å˜åŒ–ï¼ˆé˜²æ­¢ Monaco çš„ canvas è¦†ç›–ä¾§æ ï¼‰
            // è¯»å– offsetWidth ä¼šè§¦å‘å›æµ
            try { void sidebar.offsetWidth; } catch (e) {}
            // éšè—æ¢å¤æŒ‰é’®
            sidebarToggle.style.display = 'none';
            // æ¢å¤ä¾§æ æ˜¾ç¤ºååªéœ€è§¦å‘å¸ƒå±€ï¼Œç¼–è¾‘å™¨ä»ä¿æŒå¡«æ»¡å®½åº¦
            try { editorWrap && editorWrap.classList.remove('full'); } catch (e) {}
            // ç«‹å³è§¦å‘ä¸€æ¬¡å¸ƒå±€ä»¥å¿«é€Ÿå“åº”ï¼Œç¨å transitionend ä¼šè§¦å‘æœ€ç»ˆå¸ƒå±€
            try { window.editor && window.editor.layout(); } catch (e) {}
            setTimeout(() => { try { window.editor && window.editor.layout(); } catch (e) {} }, 180);
        });

        // å½“ä¾§æ è¿‡æ¸¡ç»“æŸæ—¶ï¼Œç¡®ä¿ç¼–è¾‘å™¨åšæœ€ç»ˆå¸ƒå±€ï¼ˆé¿å…åŠ¨ç”»ä¸­ canvas ä¸ä¾§æ å‡ºç°é”™ä½ï¼‰
        try {
            sidebar.addEventListener('transitionend', (ev) => {
                const prop = (ev && ev.propertyName) || '';
                if (prop.includes('width') || prop.includes('margin') || prop.includes('right') || prop.includes('opacity')) {
                    try { window.editor && window.editor.layout(); } catch (e) {}
                }
            });
        } catch (e) {}

        // ç›‘å¬ä¾§æ çš„æŠ˜å /å±•å¼€å’Œçª—å£å°ºå¯¸ä»¥åŠ¨æ€è°ƒæ•´ä¾§æ çš„ä¸Šä¸‹è¾¹ç•Œï¼Œä¿è¯ä¸é®æŒ¡å¤´éƒ¨ä¸åº•éƒ¨æ§ä»¶
        try {
            function adjustSidebarVertical() {
                try {
                    const headerEl = document.querySelector('header');
                    const toolbarEl = document.querySelector('.toolbar');
                    if (!headerEl || !toolbarEl) return;
                    const headerRect = headerEl.getBoundingClientRect();
                    const toolbarRect = toolbarEl.getBoundingClientRect();
                    // è®¡ç®—é¡¶éƒ¨è·ç¦»ï¼šå°†ä¾§æ é¡¶è¾¹æ”¾åœ¨ header åº•éƒ¨ + 8px é—´éš”
                    const topPx = Math.max(8, Math.round(headerRect.bottom + 8));
                    // è®¡ç®—åº•éƒ¨è·ç¦»ï¼šå°†ä¾§æ åº•è¾¹æ”¾åœ¨ toolbar é¡¶éƒ¨ - 8px é—´éš”
                    const bottomPx = Math.max(8, Math.round(window.innerHeight - toolbarRect.top + 8));
                    sidebar.style.top = topPx + 'px';
                    sidebar.style.bottom = bottomPx + 'px';
                } catch (e) {}
            }
            // åˆå§‹è°ƒæ•´
            adjustSidebarVertical();
            // åœ¨çª—å£è°ƒæ•´æ—¶é‡æ–°è®¡ç®—
            window.addEventListener('resize', adjustSidebarVertical);
            // åœ¨ä¾§æ æŠ˜å /å±•å¼€åä¹Ÿè°ƒæ•´ï¼ˆtransitionend ä¹Ÿä¼šè§¦å‘ editor.layoutï¼‰
            sidebar.addEventListener('transitionend', adjustSidebarVertical);
            // å½“ç”¨æˆ·ç‚¹å‡»æŠ˜å /å±•å¼€æŒ‰é’®åç«‹å³è°ƒæ•´å¹¶è§¦å‘å¸ƒå±€
            closeSb.addEventListener('click', () => { try { adjustSidebarVertical(); window.editor && window.editor.layout(); } catch (e) {} });
            sidebarToggle.addEventListener('click', () => { try { adjustSidebarVertical(); window.editor && window.editor.layout(); } catch (e) {} });
        } catch (e) {}

        // æ›´æ–°è„æ ‡è®° UIï¼ˆä»…åœ¨æ–‡ä»¶ååæ˜¾ç¤º '*'ï¼‰
        function setDirty(flag) {
            try {
                isDirty = !!flag;
                const title = currentFilename || 'main.c';
                fileTitle.textContent = title + (isDirty ? ' *' : '');
            } catch (e) {}
        }

    // æ‰“å¼€æœ¬åœ°æ–‡ä»¶ï¼šè§¦å‘éšè—çš„ file inputï¼Œè¯»å–æ–‡æœ¬å¹¶æ›¿æ¢ç¼–è¾‘å™¨å†…å®¹
    const openFileBtn = document.getElementById('openFileBtn');
    const fileInput = document.getElementById('fileInput');
    const fileTitle = document.getElementById('fileTitle');
    const saveAsBtn = document.getElementById('saveAsBtn');
    let currentFilename = 'main.c';
        openFileBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (ev) => {
            const f = ev.target.files && ev.target.files[0];
            if (!f) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const text = e.target.result;
                // å¦‚æœå½“å‰ç¼–è¾‘å™¨å†…å®¹ä¸å·²ä¿å­˜çš„ä¸ä¸€è‡´ï¼Œæé†’ç”¨æˆ·
                try {
                    const current = window.editor ? window.editor.getValue() : '';
                    const saved = localStorage.getItem('deepseek_saved_c') || '';
                    if (current !== saved) {
                        const ok = confirm('å½“å‰ç¼–è¾‘å™¨ä¸­æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ‰“å¼€æœ¬åœ°æ–‡ä»¶å°†è¦†ç›–å®ƒï¼Œç»§ç»­å—ï¼Ÿ');
                        if (!ok) return;
                    }
                } catch (e) {}
                try {
                    // å°†æ–‡ä»¶å†…å®¹å†™å…¥ç¼–è¾‘å™¨
                    window.editor && window.editor.setValue(text);
                    window.editor && window.editor.focus();
                    // æ›´æ–°å½“å‰æ–‡ä»¶åæ˜¾ç¤º
                    try { currentFilename = f.name || currentFilename; fileTitle.textContent = currentFilename; setDirty(false); } catch (e) {}
                    // æ ¹æ®æ‰©å±•è®¾å®šè¯­è¨€æ¨¡å¼ï¼ˆè‹¥ Monaco å·²å°±ç»ªï¼‰
                    try {
                        const name = f.name || '';
                        const ext = name.split('.').pop().toLowerCase();
                        let lang = 'plaintext';
                        if (ext === 'c' || ext === 'h') lang = 'c';
                        else if (ext === 'cpp' || ext === 'cxx' || ext === 'hpp' || ext === 'hxx') lang = 'cpp';
                        else lang = 'plaintext';
                        if (window.monaco && window.editor && window.editor.getModel) {
                            monaco.editor.setModelLanguage(window.editor.getModel(), lang);
                        }
                    } catch (e) {}
                } catch (e) {}
                // æ¸…ç©ºé€‰æ‹©ä»¥ä¾¿å†æ¬¡æ‰“å¼€åŒä¸€æ–‡ä»¶
                fileInput.value = '';
            };
            reader.readAsText(f);
        });

        // å¦å­˜ä¸ºï¼šä¸‹è½½å½“å‰ç¼–è¾‘å™¨å†…å®¹ä¸ºæ–‡ä»¶
        function saveAsFile() {
            try {
                const content = window.editor ? window.editor.getValue() : '';
                const name = currentFilename || 'main.c';
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = name;
                document.body.appendChild(a);
                a.click();
                a.remove();
                setTimeout(() => URL.revokeObjectURL(url), 5000);
                // å¦å­˜ä¸ºå¹¶ä¸æ”¹å˜è„çŠ¶æ€
            } catch (e) {
                console.error('å¦å­˜ä¸ºå¤±è´¥', e);
                alert('å¦å­˜ä¸ºå¤±è´¥ï¼š' + (e && e.message));
            }
        }
        saveAsBtn.addEventListener('click', saveAsFile);

        // å…¨å±æŒ‰é’®ï¼ˆä¿®å¤ï¼šæä¾›å›é€€ä»¥é˜² .frame æœªå®šä¹‰ï¼‰
        const fsBtn = document.getElementById('fsBtn');
        fsBtn.addEventListener('click', () => {
            // é¦–é€‰ .frameï¼Œå…¶æ¬¡å›é€€åˆ° .appï¼Œå†å›é€€åˆ° documentElement
            const el = document.querySelector('.frame') || document.querySelector('.app') || document.documentElement;
            if (!document.fullscreenElement) {
                el.requestFullscreen?.();
            } else {
                document.exitFullscreen?.();
            }
        });

        // é¡µé¢å¸è½½æ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆå¯é€‰ï¼‰
        window.addEventListener('beforeunload', () => {
            if (window.editor) localStorage.setItem('deepseek_saved_c', window.editor.getValue());
        });


        // é¡µé¢åŠ è½½æ—¶ï¼šè®¾ç½®ç¼–è¾‘å™¨ä¸ºæš—é»‘ä¸»é¢˜ï¼Œå¹¶é¢„çƒ­ clang-format wasm
        window.addEventListener('load', () => {
            try { if (window.monaco) monaco.editor.setTheme('vs-dark'); } catch (e) {}
            // åˆå§‹æ—¶éšè—ä¾§æ æ¢å¤æŒ‰é’®ï¼ˆé»˜è®¤å±•å¼€ï¼‰
            document.getElementById('sidebarToggle').style.display = 'none';

            // è°ƒæ•´ä¾§æ ä¸Šä¸‹è¾¹ç•Œä»¥é¿å…é®æŒ¡å¤´éƒ¨å’Œåº•éƒ¨å·¥å…·æ¡
            try { /* è°ƒæ•´å°†åœ¨ä¸‹é¢çš„è°ƒæ•´å‡½æ•°ä¸­å®Œæˆ */ } catch (e) {}

            // ç¡®ä¿ Monaco å¸ƒå±€æ­£ç¡®â€”â€”åœ¨æŸäº›æµè§ˆå™¨/å¸ƒå±€ä¸­é¦–æ¬¡æ¸²æŸ“æ—¶éœ€è¦æ‰‹åŠ¨è§¦å‘ layout
            try { window.editor && window.editor.layout(); } catch (e) {}

            // ç»‘å®šå…¨å±æŒ‰é’®ï¼ˆå®¹é”™ï¼‰ï¼šå¦‚æœä¹‹å‰ç»‘å®šå¤±è´¥ï¼Œè¿™é‡Œå†ç»‘å®šä¸€æ¬¡
            try {
                const fs = document.getElementById('fsBtn');
                if (fs && !fs.dataset._fsBound) {
                    fs.addEventListener('click', () => {
                        const el = document.querySelector('.frame') || document.querySelector('.app') || document.documentElement;
                        if (!document.fullscreenElement) {
                            el.requestFullscreen?.();
                        } else {
                            document.exitFullscreen?.();
                        }
                    });
                    fs.dataset._fsBound = '1';
                }
            } catch (e) {}

            // å·²ç§»é™¤ WASM é€‰é¡¹

            // ä¸»åŠ¨é¢„çƒ­ clang-format wasmï¼Œé¿å…é¦–æ¬¡ç‚¹å‡»æ—¶æœªåŠ è½½
            try {
                if (window['clangFormat']) {
                    window['clangFormat']('int main() {return 0;}', 'c').catch(()=>{});
                }
            } catch(e) {}
        });

        // å½“çª—å£å°ºå¯¸å˜åŒ–æ—¶ï¼Œé‡æ–°å¸ƒå±€ç¼–è¾‘å™¨ä»¥é€‚é…å®¹å™¨å¤§å°
        window.addEventListener('resize', () => { try { window.editor && window.editor.layout(); } catch (e) {} });
    </script>

    <!-- å¥¶èŒ¶å½©è›‹å¼¹çª—æ ·å¼ä¸å®¹å™¨ -->
    <style>
        #milkTeaModal{position:fixed;right:16px;bottom:60px;background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:18px 18px 14px;width:260px;box-shadow:0 12px 34px -6px rgba(0,0,0,.55);font-size:13px;line-height:1.55;color:var(--muted);z-index:3000;display:none}
        #milkTeaModal h3{margin:0 0 8px;font-size:15px;color:#fff;display:flex;align-items:center;gap:6px}
        #milkTeaModal img{width:100%;border-radius:10px;margin-top:6px;border:1px solid rgba(255,255,255,0.06)}
        #milkTeaClose{position:absolute;top:8px;right:10px;background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:14px}
        #milkTeaActions{margin-top:10px;display:flex;gap:8px}
        #milkTeaActions button{flex:1;background:var(--accent);border:0;color:#071022;padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:600;font-size:12px}
        #milkTeaActions a{flex:1;text-align:center;background:transparent;border:1px solid rgba(255,255,255,0.12);color:var(--muted);padding:6px 8px;border-radius:8px;text-decoration:none;font-size:12px}
        body.light-theme #milkTeaModal{border-color:rgba(0,0,0,0.08);box-shadow:0 10px 30px -4px rgba(0,0,0,.18)}
        body.light-theme #milkTeaModal h3{color:#0b1220}
        body.light-theme #milkTeaModal img{border-color:rgba(0,0,0,0.08)}
    </style>
    <div id="milkTeaModal" aria-hidden="true">
        <button id="milkTeaClose" aria-label="å…³é—­">âœ•</button>
        <h3><i class="fas fa-mug-hot"></i> è¯·æˆ‘å–å¥¶èŒ¶ï½</h3>
        <p>å¦‚æœè¿™ä¸ªå°å·¥å…·å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·ä½œè€…å–ä¸€æ¯å¥¶èŒ¶æ”¯æŒæŒç»­æ›´æ–° ğŸ˜„</p>
        <img src="./img/WeChat.jpeg" alt="å¾®ä¿¡æ”¶æ¬¾ç " />
        <div id="milkTeaActions">
            <button id="milkTeaOk">æˆ‘è¯·ï¼</button>
            <a href="./CHANGELOG.md" target="_blank">æ›´æ–°æ—¥å¿—</a>
        </div>
    </div>
    <!-- æ‰‹æœºé¦–æ¬¡è®¿é—®æç¤ºï¼ˆä»…æ‰‹æœºï¼Œå±•ç¤ºä¸€æ¬¡ï¼‰ -->
    <style>
        #mobileTip{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:3500}
        #mobileTip .sheet{background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:14px;width:min(420px,90vw);padding:18px;box-shadow:0 14px 40px rgba(0,0,0,.5);color:var(--muted);transform:scale(.96);opacity:0;transition:transform .22s var(--anim-enter),opacity .22s var(--anim-enter)}
        #mobileTip.open .sheet{transform:scale(1);opacity:1}
        #mobileTip h3{margin:0 0 8px;color:#fff;display:flex;align-items:center;gap:8px}
        #mobileTip p{margin:0;line-height:1.7}
        #mobileTip .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
        #mobileTip .actions button{background:var(--accent);border:0;color:#071022;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
        body.light-theme #mobileTip .sheet{border-color:rgba(0,0,0,0.08)}
        body.light-theme #mobileTip h3{color:#0b1220}
    </style>
    <div id="mobileTip" aria-hidden="true" role="dialog">
        <div class="sheet">
            <h3><i class="fas fa-mobile-screen-button"></i> å»ºè®®ä½¿ç”¨ PC ç«¯</h3>
            <p>ä¸ºè·å¾—æ›´ä½³ç¼–è¾‘ä¸è¿è¡Œä½“éªŒï¼Œå»ºè®®åœ¨ç”µè„‘æˆ– iPad æ¨ªå±ä½¿ç”¨ã€‚æ‰‹æœºå¯æµè§ˆä½†äº¤äº’å—é™ã€‚</p>
            <div class="actions"><button id="mobileTipOk">æˆ‘çŸ¥é“äº†</button></div>
        </div>
    </div>
    <script>
        (function(){
            const trigger = document.getElementById('versionLink');
            const modal = document.getElementById('milkTeaModal');
            const closeBtn = document.getElementById('milkTeaClose');
            const okBtn = document.getElementById('milkTeaOk');
            if(!trigger || !modal) return;
            function open(){
                modal.style.display='block';
                requestAnimationFrame(()=>modal.classList.add('show'));
                modal.setAttribute('aria-hidden','false');
            }
            function close(){
                modal.classList.remove('show');
                setTimeout(()=>{modal.style.display='none';modal.setAttribute('aria-hidden','true');},260);
            }
            trigger.addEventListener('click', ()=>{
                if(modal.style.display==='block'){close();return;}
                open();
            });
            closeBtn && closeBtn.addEventListener('click', close);
            okBtn && okBtn.addEventListener('click', ()=>{
                okBtn.textContent='ä¹ˆä¹ˆå“’ â¤';
                setTimeout(close,1600);
            });
        })();

        // æ‰‹æœºé¦–æ¬¡è®¿é—®æç¤º
        (function(){
            try{
                const isPhone = (Math.min(window.innerWidth, window.innerHeight) < 600) || (/Android|iPhone/i.test(navigator.userAgent) && !/iPad|Tablet/i.test(navigator.userAgent));
                if (!isPhone) return;
                if (localStorage.getItem('mobile_warned') === '1') return;
                const wrap = document.getElementById('mobileTip');
                const ok = document.getElementById('mobileTipOk');
                if (!wrap || !ok) return;
                wrap.style.display = 'flex';
                requestAnimationFrame(()=>wrap.classList.add('open'));
                wrap.setAttribute('aria-hidden','false');
                function close(){
                    wrap.classList.remove('open');
                    setTimeout(()=>{wrap.style.display='none';wrap.setAttribute('aria-hidden','true');},220);
                    try{localStorage.setItem('mobile_warned','1');}catch(e){}
                }
                ok.addEventListener('click', close);
            }catch(e){}
        })();
    </script>
</body>
</html>